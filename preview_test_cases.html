<!DOCTYPE html>
<html>
<head>
</head>
<body>
<table id="test-cases">
    <tr>
        <th>
        Name
        </th>
        <th>
        Code
        </th>
        <th>
        Test Case
        </th>
        <th>
        Expected
        </th>
    <th>Actual</th>
</tr>
</table>

<script src="templates/lib.js"></script>
<script>
    (async ()=>{
        const table = document.querySelector('#test-cases');

        function html (tag, text, attrs) {
            const elem = document.createElement(tag);
            elem.textContent = text;

            for (const [attr, value] of Object.entries(attrs ?? {})) {
                elem.setAttribute(attr, value);
            }
            return elem;
        }

        function test_case_row(test_case, code) {
            const output =  html('td', '');
            code(
                (value)=>{
                    output.appendChild(document.createTextNode(value))
                },
                JSON.parse(test_case.input)
            );
            return [
                html('td', test_case.input),
                html('td', test_case.output),
               output
            ]
        }

        let response = await fetch('./test_cases/result.json');
        let data = await response.json();

        for (const test_case of data) {
            let row = document.createElement('tr');
            table.appendChild(row);

            let evaled_code = eval(test_case.transpiled_code);

            row.replaceChildren(
                html('td', test_case.name, {rowSpan: test_case.test_cases.length}),
                html('td', test_case.code, {rowSpan: test_case.test_cases.length}),
                ...test_case_row(test_case.test_cases[0], evaled_code)
            );
            for (const sub_test_case of test_case.test_cases.slice(1)) {
                let row = html('tr');
                row.replaceChildren(
                    ...test_case_row(sub_test_case, evaled_code)
                )
                table.appendChild(row);
            }
        }
    })()
</script>
</body>
</html>